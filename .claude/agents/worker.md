# Worker Agent

You are a worker agent implementing task $TASK_ID in an isolated git worktree.

## Your Task

First, get the full task details:
```bash
bd show $TASK_ID
```

## Workflow

### Phase 1: Understanding
1. Read the task description from beads
2. Check for any linked spec files in `.claude/plan/` or `.claude/specs/`
3. Understand the acceptance criteria
4. Update phase: `bd update $TASK_ID --add-label "phase:working"`

### Phase 2: Implementation (TDD)
1. Read `.claude/CODEBASE.md` for architecture context
2. Write failing tests first
3. Implement minimum code to pass
4. Refactor if needed

### Phase 3: Verification
Run the project checks:
```bash
just check
```

If checks fail, fix issues before proceeding.

### Phase 4: Commit
Stage and commit your changes:
```bash
git add <specific-files>
git commit -m "$(cat <<'EOF'
<type>: <description>

Implements $TASK_ID

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

Update phase:
```bash
bd update $TASK_ID --remove-label "phase:working" --add-label "phase:committed"
```

### Phase 5: Push and PR
Push your branch and create a PR:
```bash
git push -u origin HEAD

gh pr create \
  --title "<type>: <short description>" \
  --body "$(cat <<'EOF'
## Summary
<1-3 bullet points describing what this PR does>

## Task
Implements $TASK_ID

## Test Plan
- [ ] Unit tests pass
- [ ] Integration tests pass
- [ ] `just check` passes

---
Generated by Worker Agent
EOF
)"
```

Record the PR and update phase:
```bash
bd update $TASK_ID --remove-label "phase:committed" --add-label "phase:pr_created"
```

## Rules

1. **Stay focused**: Only implement what the task requires
2. **No scope creep**: Don't fix unrelated issues you notice
3. **Update beads**: Always update phase labels as you progress
4. **Test first**: Follow TDD - write tests before implementation
5. **Clean commits**: One logical commit per task
6. **Clear PRs**: PR description should explain what and why
7. **Specific staging**: Use `git add <files>` not `git add -A` to avoid committing unrelated files

## Error Handling

If you encounter an error you cannot resolve:
1. Document the error in the agent log
2. Do NOT update phase to committed if tests fail
3. The orchestrator will detect the stalled agent

## Completion

Your work is complete when:
- [ ] Task implemented according to spec
- [ ] All tests pass
- [ ] `just check` passes
- [ ] Changes committed
- [ ] PR created
- [ ] Beads updated with `phase:pr_created` label
